{"id":"i-6t0g","uuid":"618d2e8a-1c17-4ebf-8805-57794bd707e9","title":"Create IAgentExecutor interface and core types","content":"## Overview\n\nCreate the foundational `IAgentExecutor` interface and all related type definitions. This is the core abstraction that all CLI agent executors will implement.\n\n## Tasks\n\n- [ ] Create `src/agents/types/agent-executor.ts`\n  - [ ] Define `IAgentExecutor` interface with all required methods\n  - [ ] Define `SpawnedChild` type\n  - [ ] Define `OutputChunk` type\n  - [ ] Define `AgentCapabilities` interface\n  - [ ] Add comprehensive JSDoc for all types\n  \n- [ ] Create `src/agents/types/index.ts`\n  - [ ] Re-export all types from agent-executor.ts\n  - [ ] Ensure backward compatibility with existing exports\n\n- [ ] Update `src/agents/index.ts`\n  - [ ] Export new types\n\n## Acceptance Criteria\n\n- [ ] All types compile with TypeScript strict mode\n- [ ] No breaking changes to existing `IAgentAdapter` interface\n- [ ] JSDoc coverage on all public types\n- [ ] Exports are properly configured\n\n## Related\n\nImplements [[s-6s6c]] - R1: IAgentExecutor Interface","status":"closed","priority":0,"assignee":null,"archived":0,"archived_at":null,"created_at":"2025-11-20 08:29:07","updated_at":"2025-11-20 09:18:14","closed_at":"2025-11-20 09:18:14","parent_id":null,"parent_uuid":null,"relationships":[{"from":"i-6t0g","from_type":"issue","to":"s-6s6c","to_type":"spec","type":"implements"}],"tags":["interfaces","sprint-1","types"],"feedback":[{"id":"FB-001","issue_id":"i-6t0g","spec_id":"s-6s6c","feedback_type":"comment","content":"## Implementation Complete: IAgentExecutor Interface (i-6t0g)\n\nSuccessfully implemented **R1: IAgentExecutor Interface** and **R7: Output Stream Types** from the spec.\n\n### What Was Accomplished\n\n1. **Created `src/agents/types/agent-executor.ts`** (~500 lines)\n   - ✅ `IAgentExecutor` interface with all required methods\n   - ✅ `AgentCapabilities` interface with protocol types\n   - ✅ `OutputChunk` and `SpawnedChild` types\n   - ✅ `NormalizedEntry` and discriminated union types\n   - ✅ `IApprovalService` interface\n   - ✅ Complete JSDoc documentation on all public APIs\n\n2. **Updated Export Chain**\n   - ✅ `src/agents/types/index.ts` - exports new types\n   - ✅ `src/agents/index.ts` - already exports from types (no changes needed)\n\n3. **Comprehensive Testing** (26 test cases)\n   - ✅ Interface type checking\n   - ✅ Discriminated union exhaustiveness\n   - ✅ All capability types\n   - ✅ Output chunk formats\n   - ✅ Normalized entry types\n   - ✅ Approval service patterns\n\n### Design Decisions Made\n\n1. **Reused Existing Types**: `SpawnedChild.process` uses `ManagedProcess` from `process/types.ts`, maintaining tight integration with existing infrastructure as specified in the spec.\n\n2. **Discriminated Unions**: Used TypeScript discriminated unions for `NormalizedEntryType`, `ActionType`, and `ApprovalDecision` to enable exhaustiveness checking and type-safe pattern matching.\n\n3. **Optional Exit Signal**: `SpawnedChild.exitSignal` allows agents using protocols like ACP to signal completion before process termination, enabling early task completion detection.\n\n4. **Markdown Content**: `NormalizedEntry.content` is always a string (markdown-formatted), forcing rendering at the UI layer for proper separation of concerns.\n\n5. **Metadata Escape Hatch**: Added `metadata` field to preserve agent-specific data that doesn't fit the normalized schema.\n\n### Integration with Existing Infrastructure\n\n**100% backward compatible** - All existing code continues to work:\n\n- No changes to `IAgentAdapter` (src/agents/types/agent-adapter.ts:108)\n- No changes to existing process layer\n- No changes to existing engine/resilience/workflow layers\n- New types exported alongside existing exports\n\n### Evidence of Completion\n\n- ✅ TypeScript compiles with strict mode: `npm run typecheck` passes\n- ✅ All 26 tests pass: `npm test -- tests/unit/agents/types/agent-executor.test.ts --run`\n- ✅ Full test suite passes: 456 tests passed across all modules\n- ✅ No breaking changes to existing functionality\n\n### Next Steps\n\nReady for next issues in the sprint. Note that many normalized output types were implemented as part of this issue since they're tightly coupled to the `IAgentExecutor` interface (R2 requirements are mostly complete).","agent":"alexngai","anchor":{"section_heading":"R1: IAgentExecutor Interface","section_level":3,"line_number":335,"line_offset":0,"text_snippet":"### R1: IAgentExecutor In...","context_before":"────────────────────────┘ ```  ---  ## Requirements","context_after":"**Priority**: P0 (Critical)  The core interface tha","content_hash":"7cd0b82b2a8a6091","anchor_status":"valid","last_verified_at":"2025-11-20T09:18:08.925Z","original_location":{"line_number":335,"section_heading":"R1: IAgentExecutor Interface"}},"dismissed":false,"created_at":"2025-11-20 09:18:08","updated_at":"2025-11-20 09:18:08"}]}
{"id":"i-1ux9","uuid":"979180ad-bffb-4245-9dbd-4ee4931a75c6","title":"Create normalized output type system","content":"## Overview\n\nDefine the unified output format that all agents will convert their output to. This enables consistent UI rendering regardless of agent type.\n\n## Tasks\n\n- [ ] Create `src/agents/types/normalized-output.ts`\n  - [ ] Define `NormalizedEntry` interface\n  - [ ] Define `NormalizedEntryType` discriminated union\n  - [ ] Define `ToolUseEntry` interface\n  - [ ] Define `ActionType` discriminated union\n  - [ ] Define `FileChange` interface\n  - [ ] Define `CommandResult` interface\n  - [ ] Define `ToolResult` interface\n  - [ ] Define `ErrorEntry` interface\n  - [ ] Add JSDoc examples for each type\n\n- [ ] Update `src/agents/types/index.ts`\n  - [ ] Export normalized output types\n\n## Acceptance Criteria\n\n- [ ] All discriminated unions are properly typed\n- [ ] IDE autocomplete works for type narrowing\n- [ ] JSDoc examples show real-world usage\n- [ ] Type safety prevents invalid combinations\n\n## Examples\n\nProvide examples of how to map:\n- Claude output → NormalizedEntry\n- Cursor tool calls → ToolUseEntry\n- File edits → ActionType with unified diff\n\n## Related\n\nImplements [[s-6s6c]] - R2: Normalized Output Types","status":"open","priority":0,"assignee":null,"archived":0,"archived_at":null,"created_at":"2025-11-20 08:29:25","updated_at":"2025-11-20 08:29:25","closed_at":null,"parent_id":null,"parent_uuid":null,"relationships":[{"from":"i-1ux9","from_type":"issue","to":"s-6s6c","to_type":"spec","type":"implements"}],"tags":["output-normalization","sprint-1","types"]}
{"id":"i-675j","uuid":"e0b261d8-364c-4e4b-b84b-a5dffbc5c3fb","title":"Create approval service interface","content":"## Overview\n\nDefine the interface for handling interactive tool approval requests from agents.\n\n## Tasks\n\n- [ ] Create `src/agents/types/approval-service.ts`\n  - [ ] Define `IApprovalService` interface\n  - [ ] Define `ApprovalRequest` type\n  - [ ] Define `ApprovalDecision` discriminated union\n  - [ ] Add JSDoc with usage patterns (auto-approve, rule-based, interactive)\n\n- [ ] Create example implementations in JSDoc\n  - [ ] AutoApprovalService example\n  - [ ] RuleBasedApprovalService example\n  - [ ] Reference to future InteractiveApprovalService\n\n- [ ] Update `src/agents/types/index.ts`\n  - [ ] Export approval service types\n\n## Acceptance Criteria\n\n- [ ] Interface supports synchronous and asynchronous approval\n- [ ] Type-safe approval decisions\n- [ ] JSDoc shows all three usage patterns\n- [ ] Unknown tool input type preserves agent-specific formats\n\n## Related\n\nImplements [[s-6s6c]] - R4: Approval Service Interface","status":"open","priority":1,"assignee":null,"archived":0,"archived_at":null,"created_at":"2025-11-20 08:29:35","updated_at":"2025-11-20 08:29:35","closed_at":null,"parent_id":null,"parent_uuid":null,"relationships":[{"from":"i-675j","from_type":"issue","to":"s-6s6c","to_type":"spec","type":"implements"}],"tags":["approvals","interfaces","sprint-1"]}
{"id":"i-65of","uuid":"3da61d8c-9da0-4245-ac99-cf4cf6ddda8f","title":"Implement BaseAgentExecutor abstract class","content":"## Overview\n\nCreate the abstract base class that provides shared functionality for all concrete agent executors.\n\n## Tasks\n\n- [ ] Create `src/agents/base/base-executor.ts`\n  - [ ] Define `BaseAgentExecutor` abstract class\n  - [ ] Implement `setApprovalService()` method\n  - [ ] Implement `checkAvailability()` default implementation\n  - [ ] Implement `requestApproval()` protected helper\n  - [ ] Implement `wrapChildProcess()` protected helper\n  - [ ] Implement `createOutputChunks()` protected helper\n  - [ ] Add comprehensive JSDoc\n\n- [ ] Create `src/agents/base/index.ts`\n  - [ ] Export `BaseAgentExecutor`\n\n- [ ] Update `src/agents/index.ts`\n  - [ ] Export base executor\n\n## Testing\n\n- [ ] Create `tests/unit/agents/base/base-executor.test.ts`\n  - [ ] Test auto-approval when no service set\n  - [ ] Test delegation to approval service\n  - [ ] Test default availability check\n  - [ ] Test process wrapping\n\n## Acceptance Criteria\n\n- [ ] 100% test coverage on concrete methods\n- [ ] All abstract methods properly declared\n- [ ] Type safety for protected helpers\n- [ ] JSDoc with usage example (subclass template)\n\n## Dependencies\n\nDepends on [[i-6t0g]], [[i-675j]]\n\n## Related\n\nImplements [[s-6s6c]] - R5: BaseAgentExecutor Abstract Class","status":"blocked","priority":1,"assignee":null,"archived":0,"archived_at":null,"created_at":"2025-11-20 08:29:50","updated_at":"2025-11-20 08:30:18","closed_at":null,"parent_id":null,"parent_uuid":null,"relationships":[{"from":"i-65of","from_type":"issue","to":"s-6s6c","to_type":"spec","type":"implements"},{"from":"i-65of","from_type":"issue","to":"i-6t0g","to_type":"issue","type":"depends-on"},{"from":"i-65of","from_type":"issue","to":"i-675j","to_type":"issue","type":"depends-on"}],"tags":["base-class","implementation","sprint-1"]}
{"id":"i-6c1n","uuid":"4da8a8fc-454a-4ece-9399-b0499dfe6ea9","title":"Implement AgentProfileRegistry system","content":"## Overview\n\nCreate the profile registry system for managing agent configurations and variants.\n\n## Tasks\n\n- [ ] Create `src/agents/profiles/types.ts`\n  - [ ] Define `AgentProfileId` interface\n  - [ ] Define `AgentProfile<TConfig>` generic interface\n  - [ ] Define `ProfileRegistry` interface\n  - [ ] Define `ExecutorFactory` type\n  - [ ] Add JSDoc with JSON schema example\n\n- [ ] Create `src/agents/profiles/registry.ts`\n  - [ ] Implement `AgentProfileRegistry` class\n  - [ ] Implement `registerExecutor()` method\n  - [ ] Implement `registerProfile()` method\n  - [ ] Implement `getExecutor()` method with variant fallback\n  - [ ] Implement `loadProfiles()` method\n  - [ ] Implement `getAllProfiles()` method\n  - [ ] Add comprehensive JSDoc\n\n- [ ] Create `src/agents/profiles/index.ts`\n  - [ ] Export all profile types and classes\n  - [ ] Export `globalProfileRegistry` singleton\n\n- [ ] Update `src/agents/index.ts`\n  - [ ] Export profile system\n\n## Testing\n\n- [ ] Create `tests/unit/agents/profiles/registry.test.ts`\n  - [ ] Test executor registration and retrieval\n  - [ ] Test profile registration\n  - [ ] Test variant fallback to default\n  - [ ] Test profile loading from JSON\n  - [ ] Test factory invocation with correct config\n\n## Acceptance Criteria\n\n- [ ] Type-safe factory pattern\n- [ ] O(1) lookups for profiles\n- [ ] Proper variant fallback logic\n- [ ] 100% test coverage\n- [ ] Example profiles.json in JSDoc\n\n## Dependencies\n\nDepends on [[i-6t0g]]\n\n## Related\n\nImplements [[s-6s6c]] - R6: Agent Profile System","status":"open","priority":1,"assignee":null,"archived":0,"archived_at":null,"created_at":"2025-11-20 08:30:18","updated_at":"2025-11-20 09:18:14","closed_at":null,"parent_id":null,"parent_uuid":null,"relationships":[{"from":"i-6c1n","from_type":"issue","to":"s-6s6c","to_type":"spec","type":"implements"},{"from":"i-6c1n","from_type":"issue","to":"i-6t0g","to_type":"issue","type":"depends-on"}],"tags":["configuration","profiles","registry","sprint-1"]}
{"id":"i-1fsw","uuid":"16384c5e-4369-4ab6-af14-01bd6e596376","title":"Create comprehensive documentation and examples","content":"## Overview\n\nDocument the Sprint 1 interfaces with comprehensive JSDoc, README updates, and usage examples.\n\n## Tasks\n\n- [ ] Ensure all public APIs have JSDoc\n  - [ ] Summary line\n  - [ ] Detailed description\n  - [ ] @param tags\n  - [ ] @returns tags\n  - [ ] @example blocks\n  - [ ] @throws documentation\n\n- [ ] Update `README.md`\n  - [ ] Add \"Agent Executors\" section\n  - [ ] Document supported agents\n  - [ ] Show basic usage example\n  - [ ] Link to detailed documentation\n\n- [ ] Create examples\n  - [ ] Example: Register and use an executor\n  - [ ] Example: Load profiles from JSON\n  - [ ] Example: Custom approval service\n  - [ ] Example: Output normalization\n\n- [ ] Add architecture diagrams\n  - [ ] Interface hierarchy\n  - [ ] Data flow diagram\n  - [ ] Sprint 1 scope vs future work\n\n## Acceptance Criteria\n\n- [ ] Every public interface/type has JSDoc\n- [ ] README shows complete working example\n- [ ] Examples are copy-pasteable and work\n- [ ] Diagrams explain key concepts visually\n\n## Dependencies\n\nDepends on all other Sprint 1 issues\n\n## Related\n\nImplements [[s-6s6c]] - Documentation Requirements","status":"blocked","priority":2,"assignee":null,"archived":0,"archived_at":null,"created_at":"2025-11-20 08:30:19","updated_at":"2025-11-20 08:30:39","closed_at":null,"parent_id":null,"parent_uuid":null,"relationships":[{"from":"i-1fsw","from_type":"issue","to":"i-6c1n","to_type":"issue","type":"depends-on"},{"from":"i-1fsw","from_type":"issue","to":"s-6s6c","to_type":"spec","type":"implements"},{"from":"i-1fsw","from_type":"issue","to":"i-6t0g","to_type":"issue","type":"depends-on"},{"from":"i-1fsw","from_type":"issue","to":"i-1ux9","to_type":"issue","type":"depends-on"},{"from":"i-1fsw","from_type":"issue","to":"i-675j","to_type":"issue","type":"depends-on"},{"from":"i-1fsw","from_type":"issue","to":"i-65of","to_type":"issue","type":"depends-on"}],"tags":["documentation","examples","sprint-1"]}
